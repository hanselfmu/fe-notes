define("/nc/1.02.46/plugin/oss/cpn/oss",["nc","./ossAli","./ossTx"],function(a,b,c){function d(a){var b=this,c=a.type;c={ali:"ali",tx:"tx"}[c]||"ali",b.getCredential=a.getCredential,b.type=c,b.envCb=[],b.initOss(a)}function e(a){var b=this,c=b.type,d={ali:k,tx:l}[c];b.oss=new d({useHttp:!!a.useHttp,getCredential:a.getCredential})}function f(a){var b=this;b.checkEnv(function(){b.oss.uploadBlob({blob:a.blob,progress:a.progress,call:a.call,error:a.error})})}function g(b){var c=this,d=c.type,e="ali"===d,f=e&&window.OSS||"tx"===d&&window.COS;if(f)return b&&b();if(c.envCb.push(b),1===c.envCb.length){var g=e?"//static.nowcoder.com/lib/aliyun-sdk.4.4.4.min.js":"//static.nowcoder.com/lib/txyun-sdk.min.js";a.async(g,function(){j.forEach(c.envCb,function(a){a&&a()}),c.envCb.length=0})}}var h=a("nc"),i=h.Clazz,j=h.Base,k=a("./ossAli"),l=a("./ossTx"),m=c.exports=i.create();j.extend(m.prototype,{initialize:d,initOss:e,uploadBlob:f,checkEnv:g})});
define("/nc/1.02.46/plugin/oss/cpn/ossAli",["nc"],function(a,b,c){function d(a){var b=this;b.rawConfig=a,b.protocol=a.useHttp?"http":"https",b.tokenCb=[]}function e(a){var b=this;b.getToken(function(b){var c=b.endpoints,d=/^https:/.test(window.location.href),c=(c||"").replace(/^https:/,"").replace(/^http:/,"");c=(d?"https:":"http:")+c;var e=new window.OSS.Wrapper({accessKeyId:b.accessKeyId,accessKeySecret:b.accessKeySecret,stsToken:b.securityToken,endpoint:c,cname:!0});e.useBucket("nowcoder"),a&&a(e,b)})}function f(a,b){var c=this,d=c.rawConfig,e=c.cacheToken;if(e){var f=(new Date).getTime(),g=e.createdAt;if(f+6e5<=g+e.expiration)return a&&a(e)}c.tokenCb.push(a),c.tokenCb.length>1&&!b||d.getCredential({call:function(a,b){var d=(new Date).getTime();m=b,n=d,a.createdAt=d,c.cacheToken=a,k.forEach(c.tokenCb,function(b){b&&b(a)}),c.tokenCb.length=0},error:function(){c.cacheToken?a&&a(c.cacheToken):window.setTimeout(function(){c.getToken(null,!0)},1e4)}})}function g(a){var b=this,c=a.blob;b.getOss(function(d,e){try{var f=(c.name||"").split(".").pop(),g=b.getRandomName()+(f?"."+f:""),h=e.path+"/"+(new Date).getTime()+"_"+g,i=new window.File([c],g,{type:c.type}),j=i.size;d.multipartUpload(h,i,{progress:function(b){return function(c){b=+b||0,a.progress&&a.progress((100*b).toFixed(2),b*j,j),c()}}}).then(function(){a.call&&a.call(b.protocol+"://uploadfiles.nowcoder.com/"+h)}).catch(function(){a.error&&a.error()})}catch(k){a.error&&a.error()}})}function h(a){a=a||32;for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890",d=c.length,e=0;e++<a;)b+=c.charAt(Math.floor(Math.random()*d));return b}var i=a("nc"),j=i.Clazz,k=i.Base,l=c.exports=j.create(),m=null,n=null;window.aliyunNCFixDate=function(){return k.id(m)?new Date(+m+((new Date).getTime()-(+n||0))):new Date},k.extend(l.prototype,{initialize:d,getOss:e,getToken:f,uploadBlob:g,getRandomName:h})});
define("/nc/1.02.46/plugin/oss/cpn/ossTx",["nc"],function(a,b,c){function d(a){var b=this;b.rawConfig=a,b.protocol=a.useHttp?"http":"https",b.tokenCb=[]}function e(a){var b=this,c=window.COS;b.getToken(function(b){var d=new c({getSTS:function(a,c){c&&c({SecretId:b.accessKeyId,SecretKey:b.accessKeySecret,XCosSecurityToken:b.securityToken})}});a&&a(d,b)})}function f(a,b){var c=this,d=c.rawConfig,e=c.cacheToken;if(e){var f=(new Date).getTime(),g=e.createdAt;if(f+6e5<=g+e.expiration)return a&&a(e)}c.tokenCb.push(a),c.tokenCb.length>1&&!b||d.getCredential({call:function(a,b){var d=(new Date).getTime();m=b,n=d,a.createdAt=d,c.cacheToken=a,k.forEach(c.tokenCb,function(b){b&&b(a)}),c.tokenCb.length=0},error:function(){c.cacheToken?a&&a(c.cacheToken):window.setTimeout(function(){c.getToken(null,!0)},1e4)}})}function g(a){var b=this,c=a.blob;b.getOss(function(d,e){try{var f=(c.name||"").split(".").pop(),g=e.path+"/"+(new Date).getTime()+"_"+b.getRandomName()+(f?"."+f:"");d.putObject({Bucket:e.bucket,Region:e.region,Key:g,Body:c,ContentType:c.type,onProgress:function(b){var c=+b.loaded||0,d=+b.total||1;a.progress&&a.progress(+(100*c/d).toFixed(2),c,d)}},function(c){!c&&a.call&&a.call(b.protocol+"://qqstatic.nowcoder.com/"+g),c&&a.error&&a.error()})}catch(h){a.error&&a.error()}})}function h(a){a=a||32;for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890",d=c.length,e=0;e++<a;)b+=c.charAt(Math.floor(Math.random()*d));return b}var i=a("nc"),j=i.Clazz,k=i.Base,l=c.exports=j.create(),m=null,n=null;window.txyunNCFixDate=function(){return k.id(m)?+new Date(+m+((new Date).getTime()-(+n||0))):+new Date},k.extend(l.prototype,{initialize:d,getOss:e,getToken:f,uploadBlob:g,getRandomName:h})});
define("/nc/1.02.46/plugin/oss/oss",["./cpn/oss","nc","./cpn/ossAli","./cpn/ossTx"],function(a,b,c){var d=a("./cpn/oss"),e=a("./cpn/ossAli"),f=a("./cpn/ossTx");c.exports={Oss:d,OssAli:e,OssTx:f}});