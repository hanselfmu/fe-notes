<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Basemark Web 3.0 | Main page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Modernizr -->
    <script type="text/javascript" src="/js/run/modernizr.min.js"></script>

    <!-- Engine -->
    <script type="text/javascript" src="/js/run/BasemarkWebEngine.js"></script>

    <style type="text/css">
        * {
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        body {
            margin: 0;
            font-family: 'Open Sans', sans-serif;
        }
        #brand-header {
            background-color: #00a2ff;
            height: 70px;
            margin-right: auto;
            margin-left: auto;
            padding-left: 15px;
            padding-right: 15px;
        }
        #brand-header img {
            height: 55px;
            margin-top: 7px;
        }

    </style>
</head>
<script type="text/javascript" src="../__includes/three.min.js"></script><script type="text/javascript" src="../__includes/WorkloadCalculator.js"></script><script type="text/javascript" src="../__includes/GraphicsTestBase.js"></script><script type="text/javascript" src="../__includes/Utilities.js"></script><link rel="stylesheet" href="../__includes/styles.css" type="text/css"><script type="text/javascript" src="includes/HeightMapGeometryGenerator.js"></script><script type="text/javascript" src="includes/GeometryStressTestScene.js"></script><script type="x-shader" id="shader">

		varying vec3 color;

		#ifdef VERTEX_SHADER

		attribute vec3 heights;

		uniform sampler2D gradient;
		uniform vec3 dimensions;
		uniform vec3 invDimensions;
		uniform float t;

		/*
		float getHeight() {
			float oneminust = 1.0 - t;
			//cubic bezier
			return (oneminust*oneminust*oneminust) * heights.x + 3.0*(oneminust*oneminust)*t*position.y + 3.0*oneminust*(t*t)*heights.y + t*t*t*heights.z;
		}*/

		//interpolation
		float interp(float f, float s, float t) {
			//float oneminust = 1.0 - t;
			//cubic bezier

			//return (oneminust*oneminust*oneminust) * f + 3.0*(oneminust*oneminust)*t*position.y + 3.0*oneminust*(t*t)*position.y + t*t*t*s;
			float newT = t*t*t*t*t*t;
			return mix(f, s, t);
		}

		//return value if the val is between ]edge1, edge2]
		float ramp(float val, float edge1, float edge2) {
			return (1.0 - step(val, edge1)) * step(val, edge2);

		}

		float getHeight() {
			float h = 0.0;
			float t3 = t * 3.0;

			h += ramp(t, -0.001, 0.33) * interp(heights.x, heights.y, t*3.0);
			h += ramp(t, 0.33, 0.66) * interp(heights.y, heights.z, (t - 0.33) * 3.0);
			h += ramp(t, 0.66, 1.0) * interp(heights.z, heights.x, (t - 0.66) * 3.0);


			return h;
		}


		void main() {

			vec3 currentPosition = vec3(position.x, getHeight(), position.z);
			float h = currentPosition.y * invDimensions.z;
			color = texture2D(gradient, vec2(h,0.5)).xyz;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( currentPosition, 1.0 );
		}

		#endif


		#ifdef FRAGMENT_SHADER
		void main() {
			gl_FragColor = vec4( color, 1.0 );
		}

		#endif


	</script>

<script type="text/javascript" src="test.js"></script><body>
<div id="brand-header">
    <img src="/images/web30_header.png" alt="Basemark Web 3.0 Total test time: 3-20 min, Mobile: Use charger, Keep screen alive!" style="max-width: 100%; max-height: 60px">
</div>
<div class="container" style="margin-left: 0; margin-right: 0">
    <h1>Geometry Stress Test (test 8/20)</h1>
    <div id="geometry-stress-test-content-area">
    </div>
</div>
<script type="text/javascript">
  var debug = false;

  var testContainerName = 'geometry-stress-test-content-area';

  BasemarkWebEngine.runTest();
</script>
</body>

</html>